import{deepMerge as t}from"../toolbox/deepMerge.js";import{safeGet as e}from"../toolbox/object.js";import{appendUrl as n}from"../toolbox/queryString.js";let r=!1,o=!1,a={};function i(e){if(!o)return console.error("DataLayer.initialize must be called first"),{};let n=[...(e=e||document).querySelectorAll("[data-lora-datalayer]")].filter(t=>!t.closest("[data-skip-datalayer]")).map(t=>{let e=t.getAttribute("data-lora-datalayer");try{e=JSON.parse(e)}catch(e){console.error("Could not get analytics from element",t)}return e});return n.length&&(n=n.reduce((e,n)=>t(e,n))),r&&console.info("Analytics data: ",n),n}function l(t){"undefined"!=typeof window&&(!function(t){o=!0,t&&!0===t.debug&&(r=!0)}(t),a=i())}function u(){return a}const c={initialize:l,update:function(e=document){if("undefined"==typeof window)return!1;let n={};return e instanceof Element?n=i(e):e===Object(e)&&(n=e),a=t(a,n),a},getCustomer:function(){return a.customer},getEndpointUrl:function(t,e){if(!t)return null;let r=a.urls.baseEndpoint.replace("_endpoint_",t);return e&&(r=n(r,e)),r},getData:u,get:function(t,n){return e(a,t,n)}};export{c as default,u as getData,l as initialize};
